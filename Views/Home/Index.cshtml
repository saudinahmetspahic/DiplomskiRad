@using WebApp.EntityModels
@model List<Notification>
@{
    var msg = (string)TempData["msg"];
}

<style>
    main {
        padding: 0px !important;
    }
</style>


@if (msg != null)
{
    <div class="warning-message">@msg</div>
}
<div class="bg-image margin-bottom-50">
    <p class="text-color-lightgray">
        <span class="font-weight-bold font-italic margin-5">“To travel is to open windows of the heart and welcome newness ”</span>
        <span class="font-size-20px"><br />― Anamika Mishra, Dreamcatcher: A Tale of Hope & Love</span>
    </p>
</div>

<div class="line">
    <p>Search programs</p>
</div>

<div id="programsPreview" class="font-family-ubuntu">

</div>

@if (Model.Any())
{
    <div class="notifications from-row-to-column column-no-space column-spread margin-top-50">
        <div id="notifications-details">

        </div>
        <div class="notification-list">
            @foreach (var notif in Model)
            {
                <h4 onclick="javascript: GetNotificationDetails('@notif.Id');"><span class="">@notif.DateCreated.ToString("dd MMM") @notif.DateCreated.ToString("HH:mm")</span> @notif.Title</h4>
            }
        </div>
    </div>
}

<div class="line">
    <p>Need help?</p>
</div>

<div class="margin-bottom-50 margin-top-50">
    <div class="custom-a">
        <div class="w-200"></div>
        <div class="custom-a-text">
            <h4>Explore</h4>
            <p>Let us help you explore Bosnia and Herzegovina. It is country full of landmarks worth visiting wherever you are coming from.</p>
        </div>
    </div>
    <div class="custom-a">
        <div class="custom-a-text">
            <h4>Contact us</h4>
            <p>Feel free to send us a message and we will reply in no time. You can chat with us via this app or you can send us an email.</p>
        </div>
        <div class="w-200"></div>
    </div>
    <div class="custom-a">
        <div class="w-200"></div>
        <div class="custom-a-text">
            <h4>Build</h4>
            <p>We are ready to take you on adventure you create. Build your own program and demand your wishes. We will make it happen.</p>
        </div>
    </div>
</div>

<div class="line">
    <p>Our friends</p>
</div>

<div id="sponsors" class="sectionMargin">

</div>

<footer id="footer">
    <div>
        <img src="~/Images/Embedded/company_logo.jpg" alt="" />
        <div class="d-flex margin-5"><div class="footer-icon"><i class="fa fa-map-marker pr-10"></i></div> Bosnia & Herzegovina<br />Zenica<br />Branilaca Bosne 14</div>
        <div class="d-flex margin-5"><div class="footer-icon"><i class="fa fa-phone pr-10"></i></div> +387/62-973-830</div>
        <div class="d-flex margin-5"><div class="footer-icon"><i class="fa fa-envelope-o pr-10"></i></div> respectzajim@gmail.com</div>
    </div>
    <div>
        <h3>Links</h3>
        <a asp-action="Index" asp-controller="Catalog">Catalog</a>
        <a asp-action="Index" asp-controller="Chat">Contact</a>
        <a asp-action="Index" asp-controller="Program">Programs</a>
        <a asp-action="Index" asp-controller="Purchase">Purchases</a>
    </div>
    <p class="rsv">2021 - New Respect - Travel Agency</p>
</footer>



<script>
    function GetNotificationDetails(notificationId) {
        $.get("/Notification/GetNotificationDetails?NotificationId=" + notificationId, function (result, status) {
            if (status === "success") {
                $("#notifications-details").html(result);
            }
        });
    }

    var interval;
    $(document).ready(function () {
        getPrograms([], 3);
        interval = setInterval(function () {
            var ids = [];
            var addedprograms = document.getElementById("programsPreview").children;
            for (var i = 0; i < addedprograms.length; i++) {
                ids.push(addedprograms.item(i).id.split('_')[1]);
            }
            getPrograms(ids, 1);
        }, 7000);
        GetNotificationDetails('@Model.Select(s=>s.Id).FirstOrDefault()');
        getSponsors();
    });

    function getPrograms(ids, num) {
        $.ajax({
            url: "/Program/GetProgramPreviews",
            method: "POST",
            data: {
                filterIds: ids,
                numberOfPrograms: num
            },
            success: function (result, status) {
                if (status === "success") {
                    $("#programsPreview").append(result);
                    var count = $("#programsPreview").children().length;
                    if (count > 3) {
                        count = count - 3;

                        console.log(count);
                        for (var i = 0; i < count; i++) {
                            $("#programsPreview").children().first().remove();
                        }
                    }
                }
            },
            error: function (xhr) {
                if (xhr.status == 406) {
                    // killing interval because there is no need for it as there is no enough programs to show
                    clearInterval(interval);
                }
            }
        });
    }

    function getSponsors() {
        $.get("/Sponsor/GetSponsorsInfo", function (result, status) {
            if (status === "success") {
                $("#sponsors").html(result);
            }
        });
    }

    $(document).ready(function () {
        setTimeout(function () {
            $(".warning-message").remove();
        }, 5000);
    });
</script>
